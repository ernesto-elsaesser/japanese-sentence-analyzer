<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Japanese Morphological Analyzer</title>
    <script src="kuromoji.js"></script>
    <style>
        form {
            display: flex;
            margin-bottom: 10px;
        }
        textarea {
            flex-grow: 1;
        }
        button {
            font-size: 18px;
            margin-left: 5px;
        }
        td {
            border: 1px solid;
            padding: 5px 10px;
        }
        a {
            text-decoration: none;
        }
    </style>
</head>
<body>

    <form>
        <textarea id="input" cols="64"></textarea>
        <button type="button" id="clear" onclick="clearInput()">üóëÔ∏è</button>
        <button type="button" id="run" disabled>‚ñ∂Ô∏è</button>
    </form>

    <table>
        <tbody id="output">
        </tbody>
    </table>

    <script>

        // https://github.com/taku910/mecab/blob/master/mecab-ipadic/pos-id.def
        const TAGS = {
            "„Éï„Ç£„É©„Éº,*,*,*": "Filler",
            "ÊÑüÂãïË©û,*,*,*": "Interjection",
            "Ë®òÂè∑,„Ç¢„É´„Éï„Ç°„Éô„ÉÉ„Éà,*,*": "Symbol: Alphabet",
            "Ë®òÂè∑,‰∏ÄËà¨,*,*": "Symbol: General",
            "Ë®òÂè∑,Êã¨ÂºßÈñã,*,*": "Symbol: Opening Bracket",
            "Ë®òÂè∑,Êã¨ÂºßÈñâ,*,*": "Symbol: Closing Bracket",
            "Ë®òÂè∑,Âè•ÁÇπ,*,*": "Symbol: Period",
            "Ë®òÂè∑,Á©∫ÁôΩ,*,*": "Symbol: Space",
            "Ë®òÂè∑,Ë™≠ÁÇπ,*,*": "Symbol: Comma",
            "ÂΩ¢ÂÆπË©û,Ëá™Á´ã,*,*": "Adjective: Independent",
            "ÂΩ¢ÂÆπË©û,Êé•Â∞æ,*,*": "Adjective: Suffix",
            "ÂΩ¢ÂÆπË©û,ÈùûËá™Á´ã,*,*": "Adjective: Dependent",
            "Âä©Ë©û,Ê†ºÂä©Ë©û,‰∏ÄËà¨,*": "Particle: Case-marking Particle: General",
            "Âä©Ë©û,Ê†ºÂä©Ë©û,ÂºïÁî®,*": "Particle: Case-marking Particle: Quotation",
            "Âä©Ë©û,Ê†ºÂä©Ë©û,ÈÄ£Ë™û,*": "Particle: Case-marking Particle: Collocation",
            "Âä©Ë©û,‰øÇÂä©Ë©û,*,*": "Particle: Binding Particle",
            "Âä©Ë©û,ÁµÇÂä©Ë©û,*,*": "Particle: Sentence-final Particle",
            "Âä©Ë©û,Êé•Á∂öÂä©Ë©û,*,*": "Particle: Conjunctional Particle",
            "Âä©Ë©û,ÁâπÊÆä,*,*": "Particle: Special",
            "Âä©Ë©û,ÂâØË©ûÂåñ,*,*": "Particle: Adverbialization",
            "Âä©Ë©û,ÂâØÂä©Ë©û,*,*": "Particle: Adverbial Particle",
            "Âä©Ë©û,ÂâØÂä©Ë©ûÔºè‰∏¶Á´ãÂä©Ë©ûÔºèÁµÇÂä©Ë©û,*,*": "Particle: Adverbial/Coordinate/Sentence-final Particle",
            "Âä©Ë©û,‰∏¶Á´ãÂä©Ë©û,*,*": "Particle: Coordinate Particle",
            "Âä©Ë©û,ÈÄ£‰ΩìÂåñ,*,*": "Particle: Adnominalization",
            "Âä©ÂãïË©û,*,*,*": "Auxiliary Verb",
            "Êé•Á∂öË©û,*,*,*": "Conjunction",
            "Êé•È†≠Ë©û,ÂΩ¢ÂÆπË©ûÊé•Á∂ö,*,*": "Prefix: Adjective-connecting",
            "Êé•È†≠Ë©û,Êï∞Êé•Á∂ö,*,*": "Prefix: Number-connecting",
            "Êé•È†≠Ë©û,ÂãïË©ûÊé•Á∂ö,*,*": "Prefix: Verb-connecting",
            "Êé•È†≠Ë©û,ÂêçË©ûÊé•Á∂ö,*,*": "Prefix: Noun-connecting",
            "ÂãïË©û,Ëá™Á´ã,*,*": "Verb: Independent",
            "ÂãïË©û,Êé•Â∞æ,*,*": "Verb: Suffix",
            "ÂãïË©û,ÈùûËá™Á´ã,*,*": "Verb: Dependent",
            "ÂâØË©û,‰∏ÄËà¨,*,*": "Adverb: General",
            "ÂâØË©û,Âä©Ë©ûÈ°ûÊé•Á∂ö,*,*": "Adverb: Particle-connecting",
            "ÂêçË©û,„ÇµÂ§âÊé•Á∂ö,*,*": "Noun: Sahen-suru Verb",
            "ÂêçË©û,„Éä„Ç§ÂΩ¢ÂÆπË©ûË™ûÂππ,*,*": "Noun: Na-adjective Stem",
            "ÂêçË©û,‰∏ÄËà¨,*,*": "Noun: General",
            "ÂêçË©û,ÂºïÁî®ÊñáÂ≠óÂàó,*,*": "Noun: Quoted String",
            "ÂêçË©û,ÂΩ¢ÂÆπÂãïË©ûË™ûÂππ,*,*": "Noun: Adjectival Noun Stem",
            "ÂêçË©û,Âõ∫ÊúâÂêçË©û,‰∏ÄËà¨,*": "Noun: Proper Noun: General",
            "ÂêçË©û,Âõ∫ÊúâÂêçË©û,‰∫∫Âêç,‰∏ÄËà¨": "Noun: Proper Noun: Person's Name: General",
            "ÂêçË©û,Âõ∫ÊúâÂêçË©û,‰∫∫Âêç,Âßì": "Noun: Proper Noun: Person's Name: Surname",
            "ÂêçË©û,Âõ∫ÊúâÂêçË©û,‰∫∫Âêç,Âêç": "Noun: Proper Noun: Person's Name: First Name",
            "ÂêçË©û,Âõ∫ÊúâÂêçË©û,ÁµÑÁπî,*": "Noun: Proper Noun: Organization",
            "ÂêçË©û,Âõ∫ÊúâÂêçË©û,Âú∞Âüü,‰∏ÄËà¨": "Noun: Proper Noun: Regional: General",
            "ÂêçË©û,Âõ∫ÊúâÂêçË©û,Âú∞Âüü,ÂõΩ": "Noun: Proper Noun: Regional: Country",
            "ÂêçË©û,Êï∞,*,*": "Noun: Number",
            "ÂêçË©û,Êé•Á∂öË©ûÁöÑ,*,*": "Noun: Conjunctional",
            "ÂêçË©û,Êé•Â∞æ,„ÇµÂ§âÊé•Á∂ö,*": "Noun: Suffix: Sahen-suru Verb",
            "ÂêçË©û,Êé•Â∞æ,‰∏ÄËà¨,*": "Noun: Suffix: General",
            "ÂêçË©û,Êé•Â∞æ,ÂΩ¢ÂÆπÂãïË©ûË™ûÂππ,*": "Noun: Suffix: Adjectival Noun Stem",
            "ÂêçË©û,Êé•Â∞æ,Âä©Êï∞Ë©û,*": "Noun: Suffix: Counter",
            "ÂêçË©û,Êé•Â∞æ,Âä©ÂãïË©ûË™ûÂππ,*": "Noun: Suffix: Auxiliary Verb Stem",
            "ÂêçË©û,Êé•Â∞æ,‰∫∫Âêç,*": "Noun: Suffix: Person's Name",
            "ÂêçË©û,Êé•Â∞æ,Âú∞Âüü,*": "Noun: Suffix: Regional",
            "ÂêçË©û,Êé•Â∞æ,ÁâπÊÆä,*": "Noun: Suffix: Special",
            "ÂêçË©û,Êé•Â∞æ,ÂâØË©ûÂèØËÉΩ,*": "Noun: Suffix: Adverbial",
            "ÂêçË©û,‰ª£ÂêçË©û,‰∏ÄËà¨,*": "Noun: Pronoun: General",
            "ÂêçË©û,‰ª£ÂêçË©û,Á∏ÆÁ¥Ñ,*": "Noun: Pronoun: Contraction",
            "ÂêçË©û,ÂãïË©ûÈùûËá™Á´ãÁöÑ,*,*": "Noun: Verb-like Dependent",
            "ÂêçË©û,ÁâπÊÆä,Âä©ÂãïË©ûË™ûÂππ,*": "Noun: Special: Auxiliary Verb Stem",
            "ÂêçË©û,ÈùûËá™Á´ã,‰∏ÄËà¨,*": "Noun: Dependent: General",
            "ÂêçË©û,ÈùûËá™Á´ã,ÂΩ¢ÂÆπÂãïË©ûË™ûÂππ,*": "Noun: Dependent: Adjectival Noun Stem",
            "ÂêçË©û,ÈùûËá™Á´ã,Âä©ÂãïË©ûË™ûÂππ,*": "Noun: Dependent: Auxiliary Verb Stem",
            "ÂêçË©û,ÈùûËá™Á´ã,ÂâØË©ûÂèØËÉΩ,*": "Noun: Dependent: Adverbial",
            "ÂêçË©û,ÂâØË©ûÂèØËÉΩ,*,*": "Noun: Adverbial",
            "ÈÄ£‰ΩìË©û,*,*,*": "Adnominal Adjective"
        }

        const INFLECTIONS = {
            // u
            "Ë™ûÂππ": "Stem",
            "Âü∫Êú¨ÂΩ¢": "Regular form",
            "ÁµÇÊ≠¢ÂΩ¢": "Terminal form",
            "ÈÄ£‰ΩìÂΩ¢": "Attributive form",

            // e
            "‰ªÆÂÆöÂΩ¢": "Hypothetical form",  // for conditional
            "ÂëΩ‰ª§ÔΩÖ": "Imperative",
            // NOTE: no ÂèØËÉΩÂΩ¢ = Potential form, tagged as either
            // Irrealis form + (ra)reru or Regular form of the *eru verb

            // a
            "Êú™ÁÑ∂ÂΩ¢": "Irrealis form", // for negative, passive, causative, potential

            // o
            "Êú™ÁÑ∂„Ç¶Êé•Á∂ö": "Tentative form", // irrealis o-derivate; for volitional/tentative

            // i
            "ÈÄ£Áî®ÂΩ¢": "Conjunctive form", // for past, desire, te, masu
            "ÈÄ£Áî®„ÇøÊé•Á∂ö": "Conjunctive form (+TA)",
            "ÈÄ£Áî®„ÉãÊé•Á∂ö": "Conjunctive form (+NI)",
            "ÈÄ£Áî®„ÉÜÊé•Á∂ö": "Conjunctive form (+TE)",

            "„Ç¨„É´Êé•Á∂ö": "Verbal adjective (+GARU)",
        }

        const input = document.getElementById("input")
        const button = document.getElementById("run")
        const output = document.getElementById("output")

        function translate(tag) {
            if (tag in TAGS) return TAG[tag]
            return "?"
        }

        function present(tokens) {
            let rows = ""

            for (let token of tokens) {
                const surface_form = token["surface_form"]
                const reading = token["reading"] || ""
                const pos = token["pos"]
                const pos1 = token["pos_detail_1"]
                const pos2 = token["pos_detail_2"]
                const pos3 = token["pos_detail_3"]
                const conjugated_form = token["conjugated_form"]
                const basic_form = token["basic_form"]
                const conjugated_type = token["conjugated_type"]

                const query = basic_form == "*" ? surface_form : basic_form
                const jisho_link = "https://jisho.org/search/" + query

                const code = surface_form.charCodeAt(0)
                const is_kanji = (code >= 0x4E00 && code <= 0x9FFF)

                rows += '<tr><td><a target="_blank" href="' + jisho_link + '">' + surface_form + "</a>"
                if (is_kanji) rows += "<br/>" + reading
                rows += "</td>"

                tags = [pos, pos1, pos2, pos3]
                rows += "<td>" + TAGS[tags.join(",")]
                rows += "<br/>" + tags.filter(t => t != "*").join(", ")
                if (conjugated_type != "*") {
                    let form = INFLECTIONS[conjugated_form]
                    if (form == undefined) form = conjugated_form
                    rows += "<br/>" + form + " of " + basic_form + " (" + conjugated_type + ")"
                }
                rows += "</td></tr>"
            }
            output.innerHTML = rows
        }
        
        function clearInput() {
            input.value = ""
        }

        kuromoji.builder({ dicPath: "dict" }).build(function (err, tokenizer) {
            button.onclick = function() {
                const sentence = input.value.replace(/\s/g, "")
                const tokens = tokenizer.tokenize(sentence)
                present(tokens)
            }
            button.disabled = false
        });

    </script>
</body>